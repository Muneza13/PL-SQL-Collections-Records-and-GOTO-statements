# PL-SQL-Collections-Records-and-GOTO-statements
Overview

This repository demonstrates PL/SQL Collections, Records, and GOTO statements through a single, coherent problem: processing and grading student quiz scores with category aggregation, business-rules validation, and exceptional control flow.

The deliverables in the repo:

1. DDL to create schema objects (tables and sample data)

2. PL/SQL package and procedures that use collections, records, and GOTO

3. Test scripts and expected output

---
Problem definition (explicit)

Designing  a PL/SQL solution for a tutoring center that accepts many quiz submissions per student and:

Aggregates quiz scores by student and by category (e.g., MATH, ENGLISH, SCIENCE).

Calculates per-student final score, weighted by category weights stored in a table.

Detects invalid scores (< 0 or > 100) and uses a GOTO controlled error-handling label to skip the offending record while recording an error row into an errors table.

Uses Records to model each input row and Collections to hold intermediate aggregates and to produce a final sorted student report.

Exposes a packaged API to: load data, process/aggregate, produce a report table, and cleanup.

DDL(data definition languague) created tables are 
Students, quiz submissions, category weights, and errors
---


CREATE TABLE students (
student_id NUMBER PRIMARY KEY,
full_name VARCHAR2(200)
);


CREATE TABLE quiz_submissions (
submission_id NUMBER PRIMARY KEY,
student_id NUMBER NOT NULL,
category VARCHAR2(50),
score NUMBER,
taken_on DATE DEFAULT SYSDATE
);


CREATE TABLE category_weights (
category VARCHAR2(50) PRIMARY KEY,
weight NUMBER -- percentage as decimal (e.g. 0.4 for 40%)
);


CREATE TABLE processing_errors (
error_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
submission_id NUMBER,
student_id NUMBER,
msg VARCHAR2(4000),
logged_on DATE DEFAULT SYSDATE
);


CREATE TABLE student_reports (
student_id NUMBER,
full_name VARCHAR2(200),
final_score NUMBER,
notes VARCHAR2(400)
);

expected output from created tables 
---
![table students](https://github.com/user-attachments/assets/a594c366-255c-43c0-af77-c5f47df84005)
![table student reports ](https://github.com/user-attachments/assets/9c03d7cf-f22b-41b7-ba2d-88e05b5277d6)
![table quiz submissions ](https://github.com/user-attachments/assets/15fe81bc-9a10-452a-92f7-33878f4da3a2)
![table processing erros ](https://github.com/user-attachments/assets/a7fd005d-c01e-4593-90d1-1f5afbcf3506)
![table category weights ](https://github.com/user-attachments/assets/dd9c5192-c689-4537-8335-5b4b533c7c9b)

inserting data into created tables (querries that used)
---
INSERT INTO students(student_id, full_name) VALUES (1,'Alice Example');
INSERT INTO students(student_id, full_name) VALUES (2,'Bob Sample');
INSERT INTO students(student_id, full_name) VALUES (3,'Charlie Test');


INSERT INTO category_weights(category, weight) VALUES ('MATH', 0.4);
INSERT INTO category_weights(category, weight) VALUES ('ENGLISH', 0.3);
INSERT INTO category_weights(category, weight) VALUES ('SCIENCE', 0.3);


INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (101, 1, 'MATH', 85);
INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (102, 1, 'ENGLISH', 78);
INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (103, 1, 'SCIENCE', 92);


INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (201, 2, 'MATH', 55);
INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (202, 2, 'ENGLISH', 60);
INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (203, 2, 'SCIENCE', 58);


-- error entering to trigger GOTO 
INSERT INTO quiz_submissions(submission_id, student_id, category, score) VALUES (301, 3, 'MATH', 105); -- this is  invalid

--output (screen shoots)
![inserting into students ](https://github.com/user-attachments/assets/aedbf026-17bb-41b9-be17-1d92a4400169)
![inserting into quizz submission ](https://github.com/user-attachments/assets/8ce8e9ac-cf39-49e5-a8fb-87b6e7e57f95)
![inserting into quizz sub](https://github.com/user-attachments/assets/55df8b8f-2c16-4c23-9e72-0cc7c7c26325)
![inserting into category weight](https://github.com/user-attachments/assets/e3af6db7-fe68-4846-a44f-5466317f177c)
![error triggering to be handled by goto](https://github.com/user-attachments/assets/8783f4f7-cf0d-4423-9b08-4c658a34e0da)

---
CREATING PROCEDURES
Notes about GOTO : The following uses GOTO handle_invalid_score; to jump to the label when input validation fails. Modern PL/SQL code should favor exceptions and structured control flow; the GOTO is included only because the assignment requires demonstration.
---
CREATE OR REPLACE PACKAGE pkg_grades IS
-- assign to record
v_rec.submission_id := s.submission_id;
v_rec.student_id := s.student_id;
v_rec.category := s.category;
v_rec.score := s.score;


-- Validate score
IF v_rec.score IS NULL OR v_rec.score < 0 OR v_rec.score > 100 THEN
-- jump to error handling using GOTO
GOTO handle_invalid_score;
END IF;


-- apply weight (default to 0 if category not found)
IF weight_map.EXISTS(v_rec.category) THEN
v_weight := weight_map(v_rec.category);
ELSE
v_weight := 0;
END IF;


-- accumulate weighted score by student
IF student_scores.EXISTS(v_rec.student_id) THEN
student_scores(v_rec.student_id) := student_scores(v_rec.student_id) + (v_rec.score * v_weight);
ELSE
student_scores(v_rec.student_id) := (v_rec.score * v_weight);
-- store the student's name for later report join
SELECT full_name INTO student_names(v_rec.student_id) FROM students WHERE student_id = v_rec.student_id;
END IF;


-- maintain recent-scores varray (push front, keep max 5)
v_recent.EXTEND;
v_recent(v_recent.COUNT) := v_rec.score;
IF v_recent.COUNT > 5 THEN
-- remove the oldest (simple approach: trim front by shifting into new varray)
NULL; -- (for demonstration - not critical to algorithm)
END IF;


CONTINUE; -- normal flow


<<handle_invalid_score>>
NULL; -- label target
-- record the error and continue with next submission
log_error(v_rec.submission_id, v_rec.student_id, 'Invalid score: ' || NVL(TO_CHAR(v_rec.score), 'NULL'));
-- continue automatically to next iteration (FOR-loop does it)
END LOOP;


-- After aggregation, persist reports
FOR idx IN student_scores.FIRST .. student_scores.LAST LOOP
IF idx IS NOT NULL AND student_scores.EXISTS(idx) THEN
INSERT INTO student_reports(student_id, full_name, final_score, notes)
VALUES (idx, student_names(idx), ROUND(student_scores(idx),2), 'Computed by pkg_grades');
END IF;
END LOOP;
COMMIT;
EXCEPTION
WHEN OTHERS THEN
-- generic error logging
log_error(NULL, NULL, 'Processing failed: ' || SQLERRM);
RAISE; -- re-raise after logging
END process_all_submissions;


PROCEDURE clear_reports IS
BEGIN
DELETE FROM student_reports;
DELETE FROM processing_errors;
COMMIT;
END;
END pkg_grades;
/
